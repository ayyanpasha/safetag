datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["payment"]
}

generator client {
  provider        = "prisma-client-js"
  output          = "../../generated/prisma"
  previewFeatures = ["multiSchema"]
}

enum PlanType {
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  YEARLY

  @@schema("payment")
}

enum SubStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  TRIALING

  @@schema("payment")
}

model Subscription {
  id                  String    @id @default(uuid()) @db.Uuid
  userId              String    @unique @db.Uuid
  plan                PlanType
  status              SubStatus @default(TRIALING)
  razorpaySubId       String?   @unique
  razorpayCustomerId  String?
  currentPeriodStart  DateTime
  currentPeriodEnd    DateTime
  vehicleLimit        Int       @default(3)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  payments Payment[]

  @@map("subscriptions")
  @@schema("payment")
}

model Payment {
  id                 String       @id @default(uuid()) @db.Uuid
  subscriptionId     String       @db.Uuid
  razorpayPaymentId  String       @unique
  razorpayOrderId    String
  amount             Int
  currency           String       @default("INR")
  status             String
  createdAt          DateTime     @default(now())

  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@map("payments")
  @@schema("payment")
}
